---
title: "Project 1: Data Exploration and Visualization"
author: "Jenny Li, Xiang Li"
date: "2021/9/17"
output: html_document
---

<!--- Begin styling code. --->
<style type="text/css">
/* Whole document: */
body{
  font-family: "Palatino Linotype", "Book Antiqua", Palatino, serif;
  font-size: 12pt;
}
h1.title {
  font-size: 38px;
  text-align: center;
}
h4.author {
  font-size: 18px;
  text-align: center;
}
h4.date {
  font-size: 18px;
  text-align: center;
}
</style>
<!--- End styling code. --->
```{r,message=FALSE,echo=FALSE}
library(tidyverse)
library(splitstackshape)
```


```{r,echo=FALSE,message=FALSE}
#full_bg<-read_csv('https://raw.githubusercontent.com/bryandmartin/STAT155/master/docs/Projects/project1_bgdataviz/boa#rd_game_raw.csv')

#write_csv(full_bg,"./Data/full_bg.csv")

full_bg<- read_csv("./Data/full_bg.csv")
```
#Instruction

```{r,echo=FALSE,message=FALSE,warning=FALSE}
#filter games published in 1950 or later and with at least 25 ratings
newFull_gb<-full_bg%>%
  filter(yearpublished>=1950,users_rated>=25)

full_gbMechanic<-newFull_gb%>%
  cSplit("category", direction="wide")

full_gbCategory<-newFull_gb%>%
  cSplit("category", direction="long")

full_gbMechanic2<-newFull_gb%>%
  cSplit("mechanic", direction="wide")

#searching for certain category(contains the word in the name)
catan<-newFull_gb%>%
  filter(grepl("Catan",name))
```


#Mian Section

>Visualtion one (games that published in each year)

```{r,echo=FALSE,message=FALSE,warning=FALSE}
#print(max(newFull_gb$yearpublished))
newFull_gb %>%
  ggplot(aes(x = yearpublished)) +
  labs(y = 'number of games published', x = 'years published') +
  #change the interval into 5 years each
  scale_x_continuous(breaks = seq(1950, 2020, by = 5)) +
  geom_histogram(binwidth = 5,color = "black",fill="deepskyblue4") +
  theme(plot.title = element_text (hjust = 0.5,
                                   face = "bold",
                                   size = 14)) +
  theme_minimal()
```
> Interpretation


>Visualization two (see the maximum playing time of each game types)

```{r,echo=FALSE,message=FALSE,warning=FALSE}
fac_lab = c(boardgame ="Board Game", boardgameexpansion="Board Game Expansion")

# filter the maxplaytime not equals to 0
newFull_gb0 <- newFull_gb %>%
  filter(maxplaytime != 0)

newFull_gb0 %>%
  ggplot(aes(x = maxplaytime)) +
  geom_histogram(binwidth = 20,  color = "black", fill = "aquamarine4", position = "identity") + 
  theme_bw(base_size = 20) +
  labs(x = 'maximum playing time') + 
  xlim(0, 400) +
  facet_grid(. ~ game_type, labeller = labeller(game_type = fac_lab))
```

>Visualization three (using stacked bar plot compare category and game types )

```{r,echo=FALSE,message=FALSE,warning=FALSE}
full_gbCategory %>%
  count(game_type, category) %>%
  group_by(category) %>%
  mutate(relfreq = n / sum(n)) 

full_gbCategory %>%
  count(game_type, category) %>%
  group_by(game_type) %>%
  mutate(relfreq = n / sum(n)) 

category_choose <- full_gbCategory %>%
  filter(category %in% c("Card Game", "Expansion for Base-game", "Wargame", "Fantasy", "Fighting", "Science Fiction"))

category_choose %>%
  ggplot(aes(x = category, fill = game_type)) + 
  geom_bar() + 
  labs(x = 'Category', y = 'Counts', fill = "type of game") + 
  scale_fill_manual(values = c("steelblue", "lightblue")) + 
  theme_bw(base_size = 11) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14), 
        legend.position = "none", 
        axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))
  # theme_minimal()
```

```{r,echo=FALSE,message=FALSE,warning=FALSE}
#resorted mechanics in the long way
full_gbMechanic3<-newFull_gb%>%
  cSplit("mechanic", direction="long")

#plot graph
full_gbMechanic3 %>%
  count(game_type, mechanic) %>%
  group_by(mechanic) %>%
  mutate(relfreq = n / sum(n)) 

full_gbMechanic3 %>%
  count(game_type, mechanic) %>%
  group_by(game_type) %>%
  mutate(relfreq = n / sum(n)) 

#count how may games in each mechanic
mechanicCounts<-full_gbMechanic3 %>%
  count(mechanic)

mechanic_choose <- full_gbMechanic3 %>%
  filter(mechanic %in% c("Dice Rolling", "Hand Management", "Set Collection", "Modular Board", "Variable Player Powers", "Hex-and-Counter"))

mechanic_choose %>%
  ggplot(aes(x = mechanic, fill = game_type)) + 
  geom_bar() + 
  labs(x = 'Mechanic', y = 'Counts', fill = "type of game") + 
  scale_fill_manual(values = c("steelblue", "lightblue")) + 
  theme_bw(base_size = 11) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14), 
        legend.position = "none", 
        axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))
  #theme_minimal()
```

>Visualization four (see average compexity with the first 6 categories which contain the most games)

```{r,echo=FALSE,message=FALSE,warning=FALSE}
#count how may games in each category
categoryCounts<-full_gbCategory %>%
  count(category)

#resorted it in the decreasing number of games in each category
newOrderCa <- categoryCounts[order(-n)]

#filter the first six category to create a new dataset
firstSixCa<-
  full_gbCategory %>% filter(category == "Card Game"|category == "Expansion for Base-game"|category == "Wargame"|category == "Fantasy"|category == "Fantasy"|category == "Fighting"|category == "Science Fiction")

firstSixCa_rm0 <- firstSixCa %>%
  filter(average_complexity != 0)
  
#boxplot
firstSixCa_rm0 %>%
  ggplot(aes(x=category, y=average_complexity)) + # categorical on x, quantitative on y
  geom_boxplot(color = 'cadetblue4',fill="cadetblue2",alpha=1/5) +
  coord_flip() +
  labs(y = 'average complexity', x = 'categories of games') +
  theme_bw(base_size = 15) +
  theme(plot.title = element_text(hjust = 0.5,
                                  face = "bold",
                                  size = 40),
        axis.text = element_text(size=10),
        axis.text.x = element_text(hjust = 1, vjust = 1),
        axis.text.y = element_text(hjust = 1, vjust = 1))
        
```

>Visualization five (average rating and average complexity)

```{r,echo=FALSE,message=FALSE,warning=FALSE}
newFull_gb %>%
  ggplot(aes(x = average_rating, y = average_complexity)) +
  geom_point(color = "steelblue", alpha = 0.2) +
  geom_smooth(method = 'lm',color='coral2')+
  labs(x = "average rating", y = "average complexity") +
  theme_bw(base_size = 15)+
  theme(plot.title = element_text(hjust = 0.5,
                                  face = "bold",
                                  size = 40),
        axis.text = element_text(size = 10),
        axis.text.x = element_text(hjust = 1, vjust = 1),
        axis.text.y = element_text(hjust = 1, vjust = 1))
```

>Viualization six (see the average rating and users rated)

```{r,echo=FALSE,message=FALSE,warning=FALSE}
newFull_gb %>%
  ggplot(aes(x = users_rated, y = average_rating)) +
  labs(y = 'average rating', x = 'the number of users rated') +
  geom_smooth(method = 'lm')+
  #take 5 points to complete a blue dot and add color to it
  geom_point(color = 'steelblue',alpha=1/5) +
  theme(plot.title = element_text(hjust = 0.5,
                                  face = "bold",
                                  size = 14)) +
  theme_minimal() 
```


#Conclusion

# Code Appendix
```{r,eval=FALSE}
#all the code in here
```

